[package]
name = "aumate"
version = "0.2.8"
edition = "2024"
rust-version = "1.85"
description = "Cross-platform desktop automation library"
license = "MIT"
repository = "https://github.com/tegojs/bot"
homepage = "https://github.com/tegojs/bot"
documentation = "https://docs.rs/aumate"
readme = "README.md"
keywords = ["automation", "desktop", "mouse", "keyboard", "screen"]
categories = ["api-bindings", "os"]
authors = ["Zhang Lin <sealday@gmail.com>"]
exclude = [
    ".github/",
    "tests/",
    "examples/",
    "benches/",
]

[lib]
name = "aumate"
crate-type = ["lib"]

[package.metadata.docs.rs]
# Build docs with only features that don't require system libraries
# Excludes: screen (xcap requires libpipewire on Linux)
no-default-features = true
features = ["input", "clipboard", "window"]
# Document all features for feature-gated items
all-features = false
# Set cfg flags for conditional compilation in docs
rustdoc-args = ["--cfg", "docsrs"]

[features]
default = ["input", "screen", "clipboard", "window"]
# Core features (no GUI deps)
input = ["dep:enigo"]
screen = ["dep:xcap", "dep:image"]
clipboard = ["dep:arboard", "dep:image"]
window = ["dep:active-win-pos-rs"]
# Event hooks for global keyboard/mouse interception
eventhooks = [
    "dep:lazy_static",
    "dep:cocoa",
    "dep:core-foundation",
    "dep:core-graphics",
    "dep:winapi",
    "dep:x11",
    "dep:mio",
    "dep:libc",
]
# Machine Learning base feature (shared by stt and ocr)
ml = [
    "dep:candle-core",
    "dep:candle-nn",
    "dep:candle-transformers",
    "dep:tokenizers",
    "dep:hf-hub",
    "dep:serde",
    "dep:serde_json",
    "dep:rand",
]
# ML with Metal acceleration (macOS)
ml-metal = ["ml", "candle-core/metal", "candle-nn/metal", "candle-transformers/metal"]
# ML with CUDA acceleration
ml-cuda = ["ml", "candle-core/cuda", "candle-nn/cuda", "candle-transformers/cuda"]
# Speech-to-text feature (Candle-based Whisper)
stt = [
    "ml",
    "input",
    "clipboard",
    "eventhooks",
    "dep:cpal",
    "dep:hound",
    "dep:ort",
    "dep:ndarray",
    "dep:reqwest",
    "dep:futures-util",
    "dep:sha2",
    "dep:byteorder",
]
# OCR feature (Candle-based TrOCR)
# Note: On macOS, also enable ml-metal for GPU acceleration
ocr = [
    "ml",
    "screen",
    "dep:image",
    "dep:reqwest",
    "dep:futures-util",
]
# OCR with Metal acceleration (macOS) - convenience alias
ocr-metal = ["ocr", "ml-metal"]
# STT with Metal acceleration (macOS) - convenience alias
stt-metal = ["stt", "ml-metal"]
# Image template matching feature
image_match = [
    "screen",
    "dep:image",
    "dep:imageproc",
]

[dependencies]
# Core (always included)
once_cell.workspace = true
tokio.workspace = true
anyhow.workspace = true
log.workspace = true
env_logger.workspace = true
thiserror.workspace = true

# Input feature
enigo = { workspace = true, optional = true }

# Screen feature
xcap = { workspace = true, optional = true }
image = { workspace = true, optional = true }
imageproc = { workspace = true, optional = true }

# Clipboard feature
arboard = { workspace = true, optional = true }

# ML dependencies
serde = { workspace = true, optional = true }
serde_json = { workspace = true, optional = true }
sha2 = { workspace = true, optional = true }

# Window feature
active-win-pos-rs = { workspace = true, optional = true }

# ML feature - rand is needed
rand = { workspace = true, optional = true }

# Eventhooks feature
lazy_static = { version = "1.4", optional = true }

# ML feature dependencies (Candle)
candle-core = { workspace = true, optional = true }
candle-nn = { workspace = true, optional = true }
candle-transformers = { workspace = true, optional = true }
tokenizers = { workspace = true, optional = true }
hf-hub = { workspace = true, optional = true }

# STT feature dependencies
cpal = { workspace = true, optional = true }
hound = { workspace = true, optional = true }
byteorder = { workspace = true, optional = true }

ort = { workspace = true, optional = true }
ndarray = { workspace = true, optional = true }
reqwest = { workspace = true, optional = true }
futures-util = { workspace = true, optional = true }

[target.'cfg(target_os = "macos")'.dependencies]
objc = { workspace = true }
# Eventhooks macOS deps
cocoa = { version = "0.24", optional = true }
core-foundation = { version = "0.9", optional = true }
core-graphics = { version = "0.22", features = ["highsierra"], optional = true }

[target.'cfg(target_os = "windows")'.dependencies]
# Eventhooks Windows deps
winapi = { version = "0.3", features = ["winuser", "errhandlingapi", "processthreadsapi"], optional = true }

[target.'cfg(target_os = "linux")'.dependencies]
# Eventhooks Linux deps
x11 = { version = "2.18", features = ["xlib", "xrecord", "xinput"], optional = true }
mio = { version = "0.8", features = ["os-poll", "os-ext"], optional = true }
libc = { version = "0.2", optional = true }
